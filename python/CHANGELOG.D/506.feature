Improve shell completion logic, make shell type argument mandatory.